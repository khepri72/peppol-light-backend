URGENCE : Corriger 2 bugs critiques d'upload (500 backend + insertBefore frontend).

SYMPT√îMES :
- Console navigateur : "NotFoundError: Failed to execute 'insertBefore' on 'Node'"
- Network : "POST /api/upload/pdf ‚Üí 500 Internal Server Error"
- R√©sultat : √©cran "Oups ! Il y a eu un probl√®me"

CAUSES PROBABLES :
1. Backend : route /api/upload/pdf l√®ve une exception non catch√©e
2. Frontend : ErrorBoundary d√©clench√© par manipulation DOM (Google button ou upload)

=== PARTIE 1 : BACKEND (PRIORIT√â) ===

1. V√©rifier que le dossier uploads/ existe √† la racine du projet
   - Si absent, le cr√©er avec mkdir -p uploads

2. Ouvrir la route POST /api/upload/pdf (probablement server/routes/upload.ts)

3. S√©curiser avec try/catch complet :
```typescript
router.post('/api/upload/pdf', authenticateToken, upload.single('file'), async (req, res) => {
  try {
    console.log('üì§ Upload started:', req.file?.originalname);
    
    if (!req.file) {
      console.error('‚ùå No file received');
      return res.status(400).json({ error: 'No file uploaded' });
    }

    console.log('‚úÖ File received, size:', req.file.size);
    
    // Votre logique d'analyse ici
    const result = await analyzeInvoice(req.file);
    
    console.log('‚úÖ Analysis complete');
    res.json(result);
    
  } catch (error: any) {
    console.error('‚ùå Upload error:', error.message);
    console.error('Stack:', error.stack);
    
    // Retourner une erreur propre
    res.status(500).json({ 
      error: 'Upload failed', 
      message: error.message,
      details: process.env.NODE_ENV === 'development' ? error.stack : undefined
    });
  }
});
```

4. V√©rifier la config Multer (limites, destination) :
```typescript
const upload = multer({ 
  dest: 'uploads/',
  limits: { fileSize: 10 * 1024 * 1024 }, // 10MB
  fileFilter: (req, file, cb) => {
    if (file.mimetype === 'application/pdf' || file.mimetype.includes('spreadsheet')) {
      cb(null, true);
    } else {
      cb(new Error('Only PDF and Excel files allowed'));
    }
  }
});
```

=== PARTIE 2 : FRONTEND ===

1. Dans client/src/pages/dashboard.tsx, chercher la fonction d'upload

2. S'assurer que les erreurs API sont catch√©es proprement :
```typescript
const handleUpload = async (file: File) => {
  try {
    const formData = new FormData();
    formData.append('file', file);
    
    const response = await fetch('/api/upload/pdf', {
      method: 'POST',
      headers: { 'Authorization': `Bearer ${token}` },
      body: formData
    });
    
    if (!response.ok) {
      const error = await response.json();
      throw new Error(error.message || 'Upload failed');
    }
    
    const data = await response.json();
    // Traiter le succ√®s
    
  } catch (error: any) {
    console.error('Upload error:', error);
    // Afficher un toast d'erreur
    toast({
      title: 'Upload failed',
      description: error.message,
      variant: 'destructive'
    });
    // NE PAS relancer l'erreur (√©vite ErrorBoundary)
  }
};
```

3. Supprimer toute manipulation DOM directe (getElementById, insertBefore, etc.)

=== PARTIE 3 : TEST ===

Apr√®s corrections :
1. Relancer le serveur
2. Tester upload sur /dashboard
3. V√©rifier les logs console backend
4. Confirmer que quota s'incr√©mente dans Airtable

R√âSULTAT ATTENDU :
‚úÖ Upload retourne 200 avec donn√©es invoice
‚úÖ Badge quota passe de 0/1 √† 1/1
‚úÖ Plus d'erreur insertBefore
‚úÖ Plus d'√©cran "Oups !"

Commence par cr√©er le dossier uploads/ et s√©curiser la route backend.
Affiche-moi les logs apr√®s le premier test.