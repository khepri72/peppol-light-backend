ğŸ¯ MISSION : Internationaliser les messages d'erreur Peppol (VERSION LIGHT)

CONTEXTE :
Les messages d'erreur de validation Peppol s'affichent en franÃ§ais mÃªme quand 
l'utilisateur sÃ©lectionne NL (nÃ©erlandais) ou EN (anglais).

OBJECTIF :
Rendre les erreurs multilingues sans toucher au backend.

APPROCHE :
- CrÃ©er un mapping code â†’ clÃ© i18n cÃ´tÃ© frontend uniquement
- Ajouter traductions FR/NL/EN
- Utiliser error.code pour choisir la bonne traduction
- Backend reste intact (zÃ©ro modification)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“ Ã‰TAPE 1 : IDENTIFIER L'AFFICHAGE ACTUEL DES ERREURS

Trouve le composant React qui affiche les erreurs de validation.

Recherche probable :
- InvoiceList.tsx ou InvoiceRow.tsx ou Dashboard.tsx
- Code type : invoice.errors?.map(error => <div>{error.message}</div>)

VÃ©rifie que error.code est disponible (devrait l'Ãªtre).

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“ Ã‰TAPE 2 : CRÃ‰ER LE MAPPING CODE â†’ CLÃ‰ I18N

CrÃ©er le fichier : client/src/utils/errorTranslations.ts

/**
 * Mapping des codes d'erreur backend vers clÃ©s de traduction i18n
 */
export const ERROR_CODE_TO_I18N: Record<string, string> = {
  // Erreurs de date
  DATE_MISSING: 'validation.errors.date_missing',
  DATE_INVALID_FORMAT: 'validation.errors.date_invalid_format',
  DATE_CONVERSION_ERROR: 'validation.errors.date_conversion_error',
  
  // Erreurs TVA
  VAT_MISSING: 'validation.errors.vat_missing',
  VAT_INVALID_FORMAT: 'validation.errors.vat_invalid_format',
  
  // Erreurs lignes de facturation
  NO_VALID_LINES: 'validation.errors.no_valid_lines',
  
  // Erreurs montants
  AMOUNTS_INCONSISTENT: 'validation.errors.amounts_inconsistent',
  
  // Erreurs rÃ©fÃ©rences
  REFERENCE_MISSING: 'validation.errors.reference_missing',
  
  // Erreurs BCE
  BCE_MISSING: 'validation.errors.bce_missing',
  BCE_INVALID: 'validation.errors.bce_invalid'
};

/**
 * Fonction helper pour traduire une erreur
 */
export function translateError(
  error: { code: string; message: string; messageParams?: any },
  t: (key: string, params?: any) => string
): string {
  const i18nKey = ERROR_CODE_TO_I18N[error.code];
  
  // Si clÃ© trouvÃ©e â†’ traduire avec paramÃ¨tres Ã©ventuels
  if (i18nKey) {
    return t(i18nKey, error.messageParams || {});
  }
  
  // Fallback : message original (franÃ§ais) si code inconnu
  return error.message || error.code;
}

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“ Ã‰TAPE 3 : AJOUTER LES TRADUCTIONS

Dans client/src/i18n/locales/fr.ts (ou fr.json selon structure) :

AJOUTER dans l'objet existant :

validation: {
  errors: {
    // Dates
    date_missing: 'Date de facture manquante',
    date_invalid_format: 'Date doit Ãªtre au format YYYY-MM-DD',
    date_conversion_error: 'Impossible de convertir la date',
    
    // TVA
    vat_missing: 'NumÃ©ro TVA fournisseur manquant',
    vat_invalid_format: 'NumÃ©ro TVA doit Ãªtre au format BE + 10 chiffres',
    
    // Lignes
    no_valid_lines: 'Aucune ligne de facturation valide (quantitÃ© et prix > 0)',
    
    // Montants
    amounts_inconsistent: 'IncohÃ©rence montants : HT({{net}}) + TVA({{vat}}) â‰  TTC({{gross}})',
    
    // RÃ©fÃ©rences
    reference_missing: 'BuyerReference ou OrderReference obligatoire (rÃ¨gle Peppol R003)',
    
    // BCE
    bce_missing: 'NumÃ©ro BCE fournisseur manquant ou invalide (10 chiffres)',
    bce_invalid: 'NumÃ©ro BCE invalide (10 chiffres requis)'
  }
}

Dans client/src/i18n/locales/nl.ts :

AJOUTER :

validation: {
  errors: {
    // Dates
    date_missing: 'Factuurdatum ontbreekt',
    date_invalid_format: 'Datum moet in formaat JJJJ-MM-DD zijn',
    date_conversion_error: 'Kan datum niet converteren',
    
    // TVA
    vat_missing: 'BTW-nummer leverancier ontbreekt',
    vat_invalid_format: 'BTW-nummer moet formaat BE + 10 cijfers hebben',
    
    // Lignes
    no_valid_lines: 'Geen geldige factuurregel (hoeveelheid en prijs > 0)',
    
    // Montants
    amounts_inconsistent: 'Inconsistente bedragen: Excl.({{net}}) + BTW({{vat}}) â‰  Incl.({{gross}})',
    
    // RÃ©fÃ©rences
    reference_missing: 'BuyerReference of OrderReference verplicht (Peppol-regel R003)',
    
    // BCE
    bce_missing: 'KBO-nummer leverancier ontbreekt of ongeldig (10 cijfers)',
    bce_invalid: 'Ongeldig KBO-nummer (10 cijfers vereist)'
  }
}

Dans client/src/i18n/locales/en.ts :

AJOUTER :

validation: {
  errors: {
    // Dates
    date_missing: 'Invoice date is missing',
    date_invalid_format: 'Date must be in YYYY-MM-DD format',
    date_conversion_error: 'Unable to convert date',
    
    // VAT
    vat_missing: 'Supplier VAT number is missing',
    vat_invalid_format: 'VAT number must be format BE + 10 digits',
    
    // Lines
    no_valid_lines: 'No valid invoice line (quantity and price > 0)',
    
    // Amounts
    amounts_inconsistent: 'Inconsistent amounts: Net({{net}}) + VAT({{vat}}) â‰  Gross({{gross}})',
    
    // References
    reference_missing: 'BuyerReference or OrderReference required (Peppol rule R003)',
    
    // BCE
    bce_missing: 'Supplier BCE number missing or invalid (10 digits)',
    bce_invalid: 'Invalid BCE number (10 digits required)'
  }
}

âš ï¸ IMPORTANT : Respecter la structure existante des fichiers de traduction.
Si c'est JSON, utiliser JSON. Si c'est TS avec export default, adapter.

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“ Ã‰TAPE 4 : MODIFIER LE COMPOSANT D'AFFICHAGE

Trouver le composant qui affiche les erreurs (probablement InvoiceList.tsx 
ou similaire).

AVANT (code actuel probable) :

{invoice.errors?.map((error, index) => (
  <div key={index} className="error">
    {error.message}
  </div>
))}

APRÃˆS (nouvelle version multilingue) :

import { useTranslation } from 'react-i18next';
import { translateError } from '@/utils/errorTranslations';

function ErrorDisplay({ errors }: { errors: any[] }) {
  const { t } = useTranslation();
  
  return (
    <>
      {errors?.map((error, index) => (
        <div key={error.code || index} className="error">
          {translateError(error, t)}
        </div>
      ))}
    </>
  );
}

OU si c'est inline :

{invoice.errors?.map((error, index) => {
  const { t } = useTranslation();
  return (
    <div key={error.code || index} className="error">
      {translateError(error, t)}
    </div>
  );
})}

ADAPTER selon le style de code du projet (composant sÃ©parÃ© ou inline).

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ… RÃ‰SULTAT ATTENDU

AprÃ¨s ces modifications :

1. Backend intact (validate.ts non modifiÃ©)
2. DonnÃ©es en base intactes
3. Changement langue FR â†’ erreurs en franÃ§ais
4. Changement langue NL â†’ erreurs en nÃ©erlandais  
5. Changement langue EN â†’ erreurs en anglais
6. Changement instantanÃ© sans recharger la page
7. ParamÃ¨tres dynamiques ({{net}}, {{vat}}, {{gross}}) affichÃ©s correctement

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ§ª TEST MANUEL

1. Upload facture-erreur.pdf
2. VÃ©rifie erreurs affichÃ©es en franÃ§ais
3. Clique bouton NL (drapeau nÃ©erlandais)
4. VÃ©rifie que TOUTES les erreurs passent en nÃ©erlandais
5. Clique bouton EN
6. VÃ©rifie que toutes les erreurs passent en anglais
7. VÃ©rifie spÃ©cifiquement l'erreur "amounts_inconsistent" 
   â†’ les montants {{net}}, {{vat}}, {{gross}} doivent s'afficher

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“Š RAPPORT FINAL

Quand terminÃ©, indique-moi :

1. Fichiers crÃ©Ã©s :
   - client/src/utils/errorTranslations.ts

2. Fichiers modifiÃ©s :
   - client/src/i18n/locales/fr.ts (ou .json)
   - client/src/i18n/locales/nl.ts
   - client/src/i18n/locales/en.ts
   - [Nom du composant qui affiche les erreurs]

3. Test effectuÃ© : Oui/Non

4. RÃ©sultat : OK ou [description problÃ¨me]

ExÃ©cute maintenant !